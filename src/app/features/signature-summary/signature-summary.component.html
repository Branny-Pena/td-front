<app-wizard-layout
  [currentStep]="3"
  [isLoading]="isSaving()"
  [nextDisabled]="!isValid() || isSaving()"
  (backClick)="onBack()"
  (nextClick)="onNext()">

  <div class="flex flex-col gap-4">
    <app-content-card title="Resumen del Cliente">
      @if (customer(); as u) {
        <dl class="grid grid-cols-[auto,minmax(0,1fr)] gap-x-10 gap-y-1 text-sm">
          <dt class="text-gray-600">Nombre:</dt>
          <dd class="font-medium min-w-0 break-words">{{ u.firstName }} {{ u.lastName }}</dd>
          <dt class="text-gray-600">DNI:</dt>
          <dd class="font-medium min-w-0 break-words">{{ u.dni }}</dd>
          @if (u.phoneNumber) {
            <dt class="text-gray-600">Teléfono:</dt>
            <dd class="font-medium min-w-0 break-words">{{ u.phoneNumber }}</dd>
          }
          @if (u.email) {
            <dt class="text-gray-600">Correo:</dt>
            <dd class="font-medium min-w-0 break-words">{{ u.email }}</dd>
          }
        </dl>
      }
    </app-content-card>

    <app-content-card title="Resumen del Vehículo">
      @if (vehicle(); as v) {
        <dl class="grid grid-cols-[auto,minmax(0,1fr)] gap-x-10 gap-y-1 text-sm">
          <dt class="text-gray-600">Marca:</dt>
          <dd class="font-medium min-w-0 break-words">{{ v.make }}</dd>
          <dt class="text-gray-600">Modelo:</dt>
          <dd class="font-medium min-w-0 break-words">{{ v.model }}</dd>
          <dt class="text-gray-600">Color:</dt>
          <dd class="font-medium min-w-0 break-words">{{ v.color }}</dd>
          <dt class="text-gray-600">Placa:</dt>
          <dd class="font-medium min-w-0 break-words">{{ v.licensePlate }}</dd>
          <dt class="text-gray-600">Ubicacion:</dt>
          <dd class="font-medium min-w-0 break-words">{{ v.location }}</dd>
          @if (v.vinNumber) {
            <dt class="text-gray-600">VIN:</dt>
            <dd class="font-medium min-w-0 break-words">{{ v.vinNumber }}</dd>
          }
        </dl>
      }
      
    </app-content-card>

    <app-content-card title="Firma Digital">
      <p class="text-sm text-gray-600 mb-4">
        Al firmar a continuación, reconozco que he recibido el vehículo para una prueba de manejo y acepto los términos y condiciones.
      </p>

      <div class="mb-4">
        <p class="text-sm font-medium text-gray-800">NOTAS:</p>
        <ol class="mt-2 list-decimal pl-5 text-sm text-gray-700 space-y-2">
          <li>
            Usted ha elegido conducir el vehículo con placa en referencia, declarando contar con licencia de conducir habilitante vigente.
          </li>
          <li>
            Usted asume las responsabilidades respecto de cualquier accidente derivado del uso del vehículo (daños propios, bienes o terceras personas); eximiendo de toda responsabilidad, sin limitación alguna, a DIVEIMPORT.
          </li>
          <li>
            En caso de causar daño al vehículo, cualquiera sea la causa que se le impute, pagará a DIVEIMPORT el deducible que genere (30% del monto indemnizable, mínimo 2%) de la póliza de seguros respectiva; además de cumplir con las obligaciones de ley o que a raíz de la póliza se deriven. Renuncia, además, al ejercicio de cualquier acción civil, judicial o administrativa que pudiera emanar del uso del vehículo y que pudiera intentarse en contra de DIVEIMPORT y su personal.
          </li>
          <li>
            Las partes acuerdan que cualquier diferencia en la interpretación o ejecución de este documento será resuelta de forma directa y amigable; sin embargo, si dicha diferencia no pudiera ser solucionada, dicha controversia será sometida a arbitraje ante la Cámara de Comercio de Lima.
          </li>
        </ol>
      </div>

      @if (signatureData(); as sig) {
        <div class="border border-gray-300 rounded-lg p-4 bg-gray-50">
          <img [src]="sig" alt="Su firma" class="max-w-full h-auto" />
          <p class="text-sm text-green-600 mt-2">Firma aceptada</p>
        </div>
      } @else {
        <app-signature-pad (signatureAccepted)="onSignatureAccepted($event)" />
      }
    </app-content-card>
  </div>

</app-wizard-layout>


