<app-wizard-layout
  [currentStep]="1"
  [totalSteps]="1"
  [showStepper]="false"
  [showBottomNav]="false">
  <div class="max-w-3xl mx-auto">
    <div class="mb-4">
      <button type="button" class="td-btn td-btn--standard" (click)="goBack()">Volver</button>
    </div>

    <app-content-card title="Detalle de respuesta">
      @if (isLoading()) {
        <div class="h-24 rounded-lg border border-gray-200 bg-gray-50 animate-pulse"></div>
      } @else {
        @if (response(); as r) {
          <div class="space-y-4">
            <div class="rounded-lg border border-gray-200 bg-white p-4">
              <div class="text-sm font-semibold text-gray-900">
                {{ r.surveyVersion.survey?.name ?? 'Encuesta' }}
              </div>

              <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                <div class="text-gray-500">
                  Cliente:
                  <span class="text-gray-900 font-medium">
                    {{ r.testDriveForm.customer?.firstName || '—' }} {{ r.testDriveForm.customer?.lastName || '' }}
                  </span>
                </div>
                <div class="text-gray-500">
                  Estado:
                  <span
                    class="font-medium"
                    [class.text-emerald-700]="r.status === 'submitted'"
                    [class.text-gray-700]="r.status !== 'submitted'">
                    {{ r.status === 'submitted' ? 'Enviada' : 'Iniciada' }}
                  </span>
                </div>

                @if (r.testDriveForm.customer?.email) {
                  <div class="text-gray-500">
                    Email: <span class="text-gray-900 font-medium">{{ r.testDriveForm.customer?.email }}</span>
                  </div>
                }
                @if (r.testDriveForm.customer?.phoneNumber) {
                  <div class="text-gray-500">
                    Teléfono: <span class="text-gray-900 font-medium">{{ r.testDriveForm.customer?.phoneNumber }}</span>
                  </div>
                }

                <div class="text-gray-500">
                  Fecha:
                  <span class="text-gray-900 font-medium">
                    {{ formatDate(r.submittedAt ?? r.createdAt) }}
                  </span>
                </div>
                <div class="text-gray-500">
                  Versión: <span class="text-gray-900 font-medium">{{ r.surveyVersion.version }}</span>
                </div>
              </div>
            </div>

            <div class="rounded-lg border border-gray-200 bg-white p-4">
              <div class="text-sm font-semibold text-gray-900 mb-3">Respuestas</div>
              @if (r.answers.length) {
                <div class="space-y-3">
                  @for (a of r.answers; track a.id) {
                    <div class="grid grid-cols-1 sm:grid-cols-[1fr,1fr] gap-2">
                      <div class="text-sm text-gray-700 font-medium">
                        {{ a.question.label }}
                      </div>
                      <div class="text-sm text-gray-900 break-words">
                        {{ formatAnswer(a) }}
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <div class="text-sm text-gray-700">
                  Aún no hay respuestas registradas.
                </div>
              }
            </div>
          </div>
        }
      }
    </app-content-card>
  </div>
</app-wizard-layout>
